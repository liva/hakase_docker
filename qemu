#!/bin/bash
dd if=/dev/zero of=/dev/shm/channel bs=1M count=1
qemu-system-x86_64 -cpu Haswell -nographic -no-reboot -d cpu_reset -D /tmp/qemu.log -hda /root/ubuntu-16.04-server-cloudimg-amd64-disk1.diff.qcow2 -hdb /root/cloud.qcow2 -smp 5 -m 4G -device ivshmem-plain,memdev=ivshmem -object memory-backend-file,id=ivshmem,share=on,mem-path=/dev/shm/channel,size=1M -net nic -net user,hostfwd=tcp::2222-:22,hostfwd=tcp::2873-:873 -serial telnet:127.0.0.1:4444,server,nowait -monitor telnet:127.0.0.1:4445,server,nowait $(if [ -c "/dev/kvm" ]; then echo --enable-kvm; else echo -loadvm snapshot1; fi) $@
